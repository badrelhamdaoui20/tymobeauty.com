(this["webpackJsonpmpr-frontend"]=this["webpackJsonpmpr-frontend"]||[]).push([[0],{274:function(e,t){},276:function(e,t){},287:function(e,t){},289:function(e,t){},316:function(e,t){},318:function(e,t){},319:function(e,t){},324:function(e,t){},326:function(e,t){},332:function(e,t){},334:function(e,t){},353:function(e,t){},365:function(e,t){},368:function(e,t){},373:function(e,t,r){},493:function(e,t,r){},537:function(e,t,r){},539:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),c=r(32),i=r.n(c),s=r(11),o=r(10),l=r.n(o),u=r(13),d=r(250),b=r.n(d);var p=r(17);function j(e){if(e)try{return new Date(e).toISOString().split("T")[0]}catch(t){return e}return e}var m=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";return e?e.replace(/\.(gif|jpg|jpeg|tiff|png|GIF|JPG|JPEG|TIFF|PNG)/,"_"+t+".$1"):e}var h=r(5),g=r(166),v=r(1);function O(e){var t=e.columns,r=e.data,n=Object(g.useTable)({columns:t,data:r,initialState:{pageIndex:0}},g.usePagination),a=n.getTableProps,c=n.getTableBodyProps,i=n.headerGroups,s=n.prepareRow,o=n.page,l=n.canPreviousPage,u=n.canNextPage,d=n.pageOptions,b=n.pageCount,p=n.gotoPage,j=n.nextPage,m=n.previousPage,f=n.setPageSize,O=n.state,x=O.pageIndex,w=O.pageSize;return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)("table",Object(h.a)(Object(h.a)({},a()),{},{children:[Object(v.jsx)("thead",{children:i.map((function(e){return Object(v.jsx)("tr",Object(h.a)(Object(h.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(v.jsx)("th",Object(h.a)(Object(h.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(v.jsx)("tbody",Object(h.a)(Object(h.a)({},c()),{},{children:o.map((function(e,t){return s(e),Object(v.jsx)("tr",Object(h.a)(Object(h.a)({},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(v.jsx)("td",Object(h.a)(Object(h.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]})),Object(v.jsxs)("div",{className:"pagination",children:[Object(v.jsx)("button",{className:"button btn",onClick:function(){return p(0)},disabled:!l,children:"<<"})," ",Object(v.jsx)("button",{className:"button btn",onClick:function(){return m()},disabled:!l,children:"<"})," ",Object(v.jsx)("button",{className:"button btn",onClick:function(){return j()},disabled:!u,children:">"})," ",Object(v.jsx)("button",{className:"button btn",onClick:function(){return p(b-1)},disabled:!u,children:">>"})," ",Object(v.jsxs)("span",{children:["Page"," ",Object(v.jsxs)("strong",{children:[x+1," of ",d.length]})," "]}),Object(v.jsx)("select",{value:w,onChange:function(e){f(Number(e.target.value))},children:[10,20,30,40,50].map((function(e){return Object(v.jsxs)("option",{value:e,children:["Show ",e," per page"]},e)}))})]})]})}r(373);var x=function(e){var t=e.children,r=e.width,n={width:"".concat(void 0===r?"150":r,"px")};return Object(v.jsxs)("div",{className:"loading-container",style:n,children:[Object(v.jsxs)("div",{className:"lds-ring",children:[Object(v.jsx)("div",{}),Object(v.jsx)("div",{}),Object(v.jsx)("div",{}),Object(v.jsx)("div",{})]}),t]})},w=r(14),y=r(15),k=r(24),N=r(25);function S(e){return Object(v.jsxs)("div",{className:"mpr-error-boundary",children:[Object(v.jsxs)("h1",{children:["My Product Registration - ",e]}),Object(v.jsx)("button",{onClick:function(){window.location.reload()},children:"Refresh"})]})}var C=function(e){Object(k.a)(r,e);var t=Object(N.a)(r);function r(){var e;Object(w.a)(this,r);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).state={error:null},e}return Object(y.a)(r,[{key:"componentDidCatch",value:function(e,t){console.log("Error boundary catch",{error:e,errorInfo:t})}},{key:"render",value:function(){return this.state.error?S(this.props.message||"Something went wrong, refresh might solve the issue"):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return console.error("Error boundary",e),{error:e}}}]),r}(a.a.Component),P=C,F=window.productReg||{},T=window.Shopify||{},R=F.appProxyPath||"/apps/product-registration";var L={productReg:F,appProxyPath:R,Shopify:T,staticAssetUrl:"https://mpr.wonderingbranches.com/static-data",form:{name:"",fields:[],slug:"",regs:[],settings:{}},collectionProducts:[],languages:{}},q=a.a.createContext(L);function A(e,t){if(!e||0===e.length)return[];var r=e.map((function(e){var r=function(e,t){var r=e.fields;if(["all","customer"].includes(e.name)){if(r=Object(p.a)(e.fields),t.form.settings.showDataCollectionConsent){var n="Tick this for us to collect data in this form";t.languages&&t.languages.dataCollectionConsentQuestion&&(n=t.languages.dataCollectionConsentQuestion),r.push({type:"tickbox",name:"_extraTAndC",label:n,description:"",value:"",options:[],required:!0,id:"".concat(Date.now(),"-ticbox-888")})}if(t.form.settings.showAcceptMarketingOnAccountCreation){var a="Accept marketing on account";t.languages&&t.languages.acceptMarketingOnAccountCreation&&(a=t.languages.acceptMarketingOnAccountCreation),r.push({type:"tickbox",name:"acceptMarketingOnAccountCreation",label:a,description:"",value:"",options:[],required:!0,id:"".concat(Date.now(),"-ticbox-889")})}}return Object(h.a)(Object(h.a)({},e),{},{fields:r})}(e,t);return r=function(e,t){if(!t.productReg.customer)return e;var r=Object(h.a)({},t.productReg.customer),n=t.productReg.customer.address;n&&(r=Object(h.a)(Object(h.a)(Object(h.a)({},r),n),{},{postCode:n.zip,province:n.province,state:n.province,country:n.country_code}));var a=e.fields.map((function(e){var t=Object(h.a)({},e);return r[e.name]&&(t.value=r[e.name]),t}));return Object(h.a)(Object(h.a)({},e),{},{fields:a})}(r,t),r}));return r}var D=new URLSearchParams(window.location.search);function I(e){var t,r,a=e.children,c=function(){var e,t,r,a,c,i,o=Object(n.useState)({}),d=Object(s.a)(o,2),b=d[0],p=d[1],j=Object(n.useState)(),m=Object(s.a)(j,2),f=m[0],g=m[1],v=Object(n.useState)(!1),O=Object(s.a)(v,2),x=O[0],w=O[1],y=Object(n.useCallback)(Object(u.a)(l.a.mark((function e(){var t,r,n,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.prev=1,t="product-registration",F.defaultFormSlug&&(t=F.defaultFormSlug),D.get("theForm")&&(t=D.get("theForm")),D.get("form")&&(t=D.get("form")),r="".concat(R,"?formSlug=").concat(t),e.next=9,fetch(r);case 9:return n=e.sent,e.next=12,n.json();case 12:if(a=e.sent){e.next=16;break}return alert("Sorry can not find the form, please make sure its the right form and try agaiin"),e.abrupt("return");case 16:a.error?(c=new Error("Error while fetching the form: ".concat(a.error)),g(c)):(p(Object(h.a)(Object(h.a)({},a),F)),g(null)),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),p({}),g(e.t0);case 23:return e.prev=23,w(!1),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[1,19,23,26]])}))),[]);Object(n.useEffect)((function(){y()}),[y]);var k=Object(h.a)(Object(h.a)({},L),{},{productReg:b,form:{slug:null===(e=b.form)||void 0===e?void 0:e.slug,name:null===(t=b.form)||void 0===t?void 0:t.name,fields:null===(r=b.form)||void 0===r?void 0:r.fields,description:null===(a=b.form)||void 0===a?void 0:a.description,regs:[],settings:null===(c=b.form)||void 0===c?void 0:c.settings},collectionProducts:b.collectionProducts,languages:b.languageMapping||{}}),N=!1;return k.form.settings&&(k.form.settings.skipCustomerDetailOnLoggedIn&&k.productReg.customer&&(N=!0),k.form.settings.skipCustomer=N),k.form.fields=A(null===(i=b.form)||void 0===i?void 0:i.fields,k),console.log("Settings",k),{settings:k,loading:x,error:f}}(),i=c.settings,o=c.loading,d=c.error;if(d)return S(String(d));if(o||0===Object.keys(i.productReg).length)return Object(v.jsx)(x,{children:"Loading"});if((null===(t=i.form)||void 0===t||null===(r=t.settings)||void 0===r?void 0:r.onlyLoginCustomerAllowRegister)&&!window.productReg.customer){var b="Sorry, you need to login to register";return i.languages.onlyLoginCustomerAllowRegisterText&&(b=i.languages.onlyLoginCustomerAllowRegisterText),Object(v.jsx)("div",{id:"product-registration-not-allow",dangerouslySetInnerHTML:{__html:b}})}return Object(v.jsx)(q.Provider,{value:i,children:a})}function E(){var e=a.a.useContext(q);if(void 0===e)throw new Error("useSettings must be used within a SettingsProvider");return e}var M={},_=a.a.createContext(M);function H(e){var t=e.children,r=E().languages;return Object(v.jsx)(_.Provider,{value:r,children:t})}function B(){var e=a.a.useContext(_);if(void 0===e)throw new Error("useLanguages must be used within a LanguagesProvider");var t=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return void 0!==e[t]?e[t]:r||t};return{languages:e,getLng:t,statusLng:function(e){var r="status".concat(e),n=t(r);return n!==r?n:e}}}var V=r(251),z=Object(V.flatMap)({product:[],customer:["name","firstName","surname","dob","email","address1","address2","city","country","state","postCode","phone"]});function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return Object(v.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",children:Object(v.jsx)("img",{src:e,alt:t,width:"100"})})}function G(e,t){var r,n;if(""===t)return t;switch(e.type){case"product":var a=t.imageUrl;(null===(r=t.image)||void 0===r?void 0:r.src)&&(a=t.image.src);var c=t.handle;return c&&!t.handle.match(/^\/products\//g)&&(c="/products/".concat(t.handle)),function(e,t,r){return t?Object(v.jsxs)("a",{href:t,target:"_blank",rel:"noreferrer",children:[r&&Object(v.jsx)("img",{className:"mpr-registered-product-image",src:f(r),alt:e}),Object(v.jsx)("br",{}),Object(v.jsx)("span",{children:e})]}):Object(v.jsxs)(v.Fragment,{children:[r&&Object(v.jsx)("img",{className:"mpr-registered-product-image",src:f(r),alt:e}),Object(v.jsx)("span",{children:e})]})}(t.title,c,a);case"serialNumber":case"serialNumbers":return t.join(", ");case"file":return"images"===e.fileType?U(t,e.label):t;case"date":return j(t);case"video":return n=t,Object(v.jsxs)("video",{width:"320",height:"240",controls:!0,children:[Object(v.jsx)("source",{src:n,type:"video/mp4"}),"Your browser does not support the video tag."]});case"image":return U(t,e.label);case"checkbox":return t?"True":"False";default:return String(t)}}function J(e){var t=[];return e.fields.forEach((function(e){e.fields.forEach((function(e){z.includes(e.name)||t.push({id:e.id,Header:e.label,Cell:function(t){var r=t.cell;return function(e,t){var r="",n=t.row.original;return n.fieldData&&n.fieldData[e.name]&&(r=n.fieldData[e.name]),G(e,r)}(e,r)}})}))})),t}function Q(e){var t=[],r={};return e.forEach((function(e){e.extraFields&&e.extraFields.forEach((function(e){r[e.name]=e}))})),Object.keys(r).forEach((function(e){var n=r[e];"textOnly"!==n.type&&t.push({Header:n.name,accessor:"extra".concat(n.name),Cell:function(e){var t=e.cell;return function(e,t){var r=t.row.original,n="";return r.extraFields&&r.extraFields.forEach((function(t){t.id===e.id&&(n=t.value)})),G(e,n)}(n,t)}})})),t}var K=function(e){var t=e.form,r=function(e,t,r){var n=[{Header:r("ID"),accessor:"id"}],a=J(e);if(n.push.apply(n,Object(p.a)(a)),t.productReg.showSerialNumbersDataInRegisteredProducts){var c=r("clickToDownload");n.push({Header:r("data"),accessor:"snData",Cell:function(e){var t,n=e.cell;if(null===(t=n.value)||void 0===t?void 0:t.downloads){var a=n.value.downloads.map((function(e){return Object(v.jsx)("div",{children:Object(v.jsxs)("a",{href:e.url,target:"_blank",rel:"noreferrer",children:[Object(v.jsx)("span",{className:"mpr-asset-name",children:e.name})," ",Object(v.jsx)("span",{className:"mpr-download-action",children:c})]})})}));if(a.length>0)return Object(v.jsxs)("div",{children:[Object(v.jsx)("p",{className:"mpr-download-title",children:r("downloadsAvailable")}),a]})}return null}})}if(!!t.productReg.showWarrantyToCustomer&&t.productReg.showWarrantyToCustomer&&n.push({Header:r("warrantyUntil"),accessor:"warrantyUntilText"}),e.regs){var i=Q(e.regs);n.push.apply(n,Object(p.a)(i))}n.push.apply(n,[{Header:r("status"),accessor:"status"},{Header:r("createdAt"),accessor:"createdAt"}]),t.productReg.showDob&&t.productReg.showDob&&n.push({Header:r("dob"),accessor:"customerDob"});var s=t.productReg.claimForms;if(Object.keys(s).length>0){var o=Object.keys(s)[0]||"claim-warranty";n.push({Header:r("actions"),accessor:"actions",Cell:function(){return Object(v.jsx)("button",{className:"button btn btn-primary",onClick:function(){window.open("?form=".concat(o),"_blank")},children:r("makeClaim")})}})}return{headings:n,entries:e.regs}}(t,e.settings,B().getLng),n=r.headings,c=r.entries;console.log("the make columns and data",{headings:n,entries:c,name:t.name});var i=a.a.useMemo((function(){return n}),[n]),s=a.a.useMemo((function(){return c}),[c]);return Object(v.jsx)(O,{columns:i,data:s})};function W(e){var t=e.settings,r=e.form,a=Object(n.useState)(!0),c=Object(s.a)(a,2),i=c[0],o=c[1],l="mpr-registered-".concat(r.slug),u="+ ".concat(r.name);i||(u="- ".concat(r.name));var d=["registered-products"];return i&&d.push("hide"),Object(v.jsxs)("div",{id:l,className:"mpr-registered-form-container my-product-reg-listing",children:[Object(v.jsx)("input",{className:"button btn btn-primary",type:"button",value:u,onClick:function(){return o(!i)}}),Object(v.jsx)("div",{className:"clear"}),Object(v.jsxs)("div",{className:d.join(" "),children:[Object(v.jsx)("h1",{children:r.name}),Object(v.jsx)("div",{className:"VueTables, VueTables--client",children:Object(v.jsx)("div",{className:"table-responsive",children:Object(v.jsx)(K,{settings:t,form:r})})})]})]})}var Z,$,Y=function(){var e=E(),t=function(e){var t=Object(n.useState)(),r=Object(s.a)(t,2),a=r[0],c=r[1],i=Object(n.useState)(),o=Object(s.a)(i,2),d=o[0],p=o[1],j=Object(n.useState)(!1),m=Object(s.a)(j,2),f=m[0],h=m[1],g=Object(n.useCallback)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r,n,a,i,s,o,u,d,j,m,f,g,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h(!0),e.prev=1,r="",e.next=10;break;case 10:if(t.productReg.customer&&t.productReg.customer.id){e.next=13;break}return console.log("No customer"),e.abrupt("return");case 13:u=b.a.createHash("sha256"),d=[null===(n=t.productReg.customer)||void 0===n?void 0:n.id,null===(a=t.productReg.customer)||void 0===a?void 0:a.email],(null===(i=t.Shopify)||void 0===i?void 0:i.shop)&&d.push(t.Shopify.shop),j=d.join(""),u.update(j),r=t.appProxyPath+"?listing=true&customerId="+(null===(s=t.productReg.customer)||void 0===s?void 0:s.id)+"&email="+encodeURIComponent(null===(o=t.productReg.customer)||void 0===o?void 0:o.email)+"&hash="+u.digest("hex");case 19:if(t.form&&(r+="&type=".concat(t.form.slug)),r){e.next=22;break}return e.abrupt("return");case 22:return e.next=24,fetch(r);case 24:return m=e.sent,e.next=27,m.json();case 27:f=e.sent,g=f.data,v=new CustomEvent("_mpr_registrations_listed",{detail:g}),window.dispatchEvent(v),console.log("going to set the entries",g),c(g),p(null),e.next=40;break;case 36:e.prev=36,e.t0=e.catch(1),c(null),p(e.t0);case 40:return e.prev=40,h(!1),e.finish(40);case 43:case"end":return e.stop()}}),e,null,[[1,36,40,43]])})));return function(t){return e.apply(this,arguments)}}(),[]);return Object(n.useEffect)((function(){g(e)}),[g,e]),{entries:a,error:d,loading:f}}(e),r=t.entries,a=t.loading,c=t.error,i=B().getLng;if(a)return Object(v.jsx)(x,{children:"Loading registered entries..."});if(c)return Object(v.jsxs)("div",{children:["Sorry error while getting registered products ",String(c)]});if(!r||0===r.length)return console.log("No registered products"),null;var o=r.map((function(t){return Object(v.jsx)(W,{settings:e,form:t},t.slug)}));return Object(v.jsxs)("div",{id:"mpr-registered",children:[Object(v.jsx)("h1",{children:i("registeredEntries")}),o]})},X=r(59);!function(e){e.product="product",e.serialNumber="serialNumber",e.serialNumbers="serialNumbers",e.date="date",e.file="file",e.textInput="textInput",e.email="email",e.country="country",e.state="state",e.phone="phone",e.dropdown="dropdown",e.checkboxes="checkboxes",e.radio="radio",e.tickbox="tickbox",e.textArea="textArea"}(Z||(Z={})),function(e){e.product="product",e.customer="customer",e.all="all"}($||($={}));var ee=r(260),te=r.n(ee),re=r(22),ne=function(e){var t=e.label,r=e.required;return Object(v.jsxs)("span",{className:"mpr-label-content",children:[Object(v.jsx)("div",{className:"mpr-custom-label",dangerouslySetInnerHTML:{__html:t}}),r&&Object(v.jsx)("span",{className:"mpr-input-required",children:"*"})]})};function ae(e){return e.value&&""===e.value?e.value:(t=e.label)?t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""):t;var t}var ce=function(e){var t=e.name,r=e.id,a=e.values,c=e.disabled,i=e.other,o=e.form,l=Object(n.useState)(""),u=Object(s.a)(l,2),d=u[0],b=u[1],p=B().getLng,j=p("selectOtherOptionPlaceholder","Put other option here");return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)(re.b,{as:"select",name:t,id:r,disabled:c,value:d,onChange:function(e){var r=e.target.value;o.setFieldValue(t,r),b(r)},children:[Object(v.jsx)("option",{}),a.map((function(e){return Object(v.jsx)("option",{value:ae(e),label:e.label,children:e.label},e.id)})),i&&Object(v.jsx)("option",{value:"other",label:"other",children:p("selectOtherOptionName","Other")},"other")]}),"other"===d&&Object(v.jsx)("div",{children:Object(v.jsxs)("label",{children:[Object(v.jsx)(ne,{label:j}),":",Object(v.jsx)("input",{type:"text",placeholder:p("selectOtherOptionPlaceholder"),onBlur:function(e){var r=e.target.value;o.setFieldValue(t,r)}})]})})]})},ie=function(e){var t=e.name,r=e.values,n=e.id,a=e.disabled;return Object(v.jsx)("div",{role:"group",id:n,children:r.map((function(e){return Object(v.jsxs)("label",{children:[Object(v.jsx)("span",{children:e.label}),Object(v.jsx)(re.b,{type:"radio",id:e.id,name:t,value:e.value,disabled:a})]},e.id)}))})},se=function(e){var t=e.label,r=e.name,n=e.required,a=e.disabled;return Object(v.jsx)("div",{className:"mpr-input-tickbox",children:Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(re.b,{type:"checkbox",name:r,disabled:a}),Object(v.jsx)(ne,{label:t,required:n})]})})},oe=function(e){var t=e.fill,r=void 0===t?"#5C5F62":t;return Object(v.jsx)("svg",{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:Object(v.jsx)("path",{d:"M7.293 14.707l-3-3a.999.999 0 111.414-1.414l2.236 2.236 6.298-7.18a.999.999 0 111.518 1.3l-7 8a1 1 0 01-.72.35 1.017 1.017 0 01-.746-.292z",fill:r})})},le=function(e){var t=e.fill,r=void 0===t?"#5C5F62":t;return Object(v.jsx)("svg",{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:Object(v.jsx)("path",{d:"M10 20C4.486 20 0 15.514 0 10S4.486 0 10 0s10 4.486 10 10-4.486 10-10 10zm1-15a1 1 0 10-2 0v5a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V5z",fill:r})})},ue=function(e){var t=e.fill,r=void 0===t?"#5C5F62":t;return Object(v.jsx)("svg",{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:Object(v.jsx)("path",{d:"M10 18a8 8 0 110-16 8 8 0 010 16zM9 9a1 1 0 002 0V7a1 1 0 10-2 0v2zm0 4a1 1 0 102 0 1 1 0 00-2 0z",fill:r})})};function de(e,t,r){return be.apply(this,arguments)}function be(){return(be=Object(u.a)(l.a.mark((function e(t,r,n){var a,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Validate serial number api call...",t),e.prev=1,a="".concat(r,"?validateSerialNumber=True&serialNumber=").concat(t.value,"&formSlug=").concat(n),e.next=5,fetch(a);case 5:return c=e.sent,e.next=8,c.json();case 8:if(i=e.sent,console.log("the validation data",i),!i||!i.valid){e.next=12;break}return e.abrupt("return",Object(h.a)(Object(h.a)({},t),{},{valid:!0,validating:!1}));case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("error whiling validation serial number",e.t0),alert("Sorry, can not validate serial number right now, please try again later");case 18:return e.abrupt("return",Object(h.a)(Object(h.a)({},t),{},{valid:!1,validating:!1}));case 19:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function pe(e,t){return console.log("validate against regexes",e,t),t.filter((function(t){var r=t.replace(/\\\\/g,"\\").replace(/\/\//g,"/");return new RegExp(r).test(e)})).length>0?{value:e,valid:!0,validating:!1}:{value:e,valid:!1,validating:!1}}var je=function(e){var t=e.id,r=e.label,a=e.required,c=e.placeholder,i=e.field,o=e.form,d=e.disabled,b=E(),j=B().getLng,f=Object(n.useState)(""),g=Object(s.a)(f,2),O=g[0],x=g[1],w=Object(n.useState)([]),y=Object(s.a)(w,2),k=y[0],N=y[1],S=b.form.settings,C=S.serialNumberRegex,P=(S.oneTimeSerialNumber,S.validateSerialNumber);S.enableMultipleSerialNumbers,S.serialNumbersCaseIncensitive;console.log("submiiteed",k);var F=Object(n.useCallback)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(500);case 2:if(P){e.next=5;break}return console.log("No need to validate serial number"),e.abrupt("return",Object(h.a)(Object(h.a)({},t),{},{valid:!0,validating:!1}));case 5:if(!(C&&C.length>0)){e.next=9;break}if(!(r=pe(t.value,C)).valid){e.next=9;break}return e.abrupt("return",r);case 9:return e.abrupt("return",de(t,b.appProxyPath,b.form.slug));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[C,b.appProxyPath,P]),T=Object(n.useCallback)(Object(u.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O){e.next=2;break}return e.abrupt("return");case 2:if(!k.some((function(e){return e.value===O}))){e.next=5;break}return alert("".concat(O," - already exist")),e.abrupt("return");case 5:return t={value:O,valid:!1,validating:!0},console.log("going to set submitted",t),N((function(e){return[].concat(Object(p.a)(e),[t])})),x(""),e.next=11,F(t);case 11:r=e.sent,console.log("going to set submitted 2",t),N((function(e){return e.map((function(e){return e.value===r.value?r:e}))}));case 14:case"end":return e.stop()}}),e)}))),[O,k,F]);return Object(n.useEffect)((function(){var e=k.filter((function(e){return e.valid&&!e.validating}));o.setFieldValue(i.name,e.length>0?e.map((function(e){return e.value})):[])}),[i.name,k]),Object(v.jsxs)("div",{className:"mpr-input-serial-number",children:[Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(ne,{label:r,required:a}),Object(v.jsx)("input",{disabled:d||k.some((function(e){return e.validating})),type:"text",placeholder:c||"",onKeyDown:function(e){e&&"Enter"===e.key&&T()},onBlur:T,onChange:function(e){return x(e.target.value)},value:O,id:t})]}),k.length>0&&Object(v.jsx)("ul",{className:"mpr-sn-listing",children:k.map((function(e){return Object(v.jsxs)("li",{className:"mpr-serial-number-entry",children:[Object(v.jsx)("div",{className:"mpr-sn-indicator",children:e.validating?Object(v.jsx)(le,{}):e.valid?Object(v.jsx)(oe,{fill:"green"}):Object(v.jsx)(ue,{fill:"red"})})," ",Object(v.jsx)("div",{className:"mpr-serial-number-value",children:e.value})," ",!e.validating&&!e.valid&&j("serialNumberValidationInvalid","invalid")," ",Object(v.jsx)("button",{onClick:function(){N((function(t){return t.filter((function(t){return t.value!==e.value}))}))},children:"delete"})]},e.value)}))})]})},me=r(254),fe=null,he=function(e){var t=e.country,r=e.field,a=e.form,c=e.disabled,i=Object(n.useState)([]),o=Object(s.a)(i,2),d=o[0],b=o[1];function p(){return p=Object(u.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe){e.next=11;break}return fe={},e.next=4,fetch("https://mpr.wonderingbranches.com/static-data/states.json",{cache:"force-cache"});case 4:return n=e.sent,e.next=7,n.json();case 7:r=e.sent,fe=r,e.next=12;break;case 11:r=fe;case 12:return t&&t in r&&b(Object.entries(r[t]).map((function(e){var t=Object(s.a)(e,2),r=(t[0],t[1]);return{value:r,label:r}}))),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}return Object(n.useEffect)((function(){!function(e){p.apply(this,arguments)}(t)}),[a,r,t]),Object(v.jsx)(me.a,{options:d,name:r.name,value:{value:r.value,label:r.value},onChange:function(e){if(e&&e.label){var t=e.label||"";a.setFieldValue(r.name,t)}},isDisabled:Boolean(c)})},ge=Object(n.memo)(he),ve=r(107),Oe=null,xe=function(e){var t=e.field,r=e.form,n=e.disabled;return Object(v.jsx)(ve.a,{cacheOptions:!0,defaultOptions:!0,name:t.name,defaultValue:t.value,isDisabled:n,onChange:function(e){r.setFieldValue("state",""),r.setFieldValue(t.name,e.value)},loadOptions:function(){var e=Object(u.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Oe){e.next=10;break}return e.next=3,fetch("https://mpr.wonderingbranches.com/static-data/countries.json",{cache:"force-cache"});case 3:return n=e.sent,e.next=6,n.json();case 6:Oe=e.sent,r=Oe,e.next=11;break;case 10:r=Oe;case 11:return e.abrupt("return",Object.entries(r).filter((function(e){var r=Object(s.a)(e,2);r[0];return r[1].toLowerCase().includes(t.toLowerCase())})).map((function(e){var t=Object(s.a)(e,2);return{value:t[0],label:t[1]}})));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})},we=Object(n.memo)(xe),ye={images:"image/*,.pdf"};function ke(e,t){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(u.a)(l.a.mark((function e(t,r){var n,a,c,i,s,o,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t[0].name,a=t[0].type,c=String(t[0].size),i=new URLSearchParams({signS3:"true",fileName:n,fileType:a,fileSize:c}),e.next=6,fetch("".concat(r,"?").concat(i));case 6:return s=e.sent,e.next=9,s.json();case 9:if((o=e.sent)||o.signedRequest){e.next=12;break}throw new Error("Can not sign file upload request");case 12:return u={method:"PUT",headers:{"Content-Type":a},body:t[0]},e.next=15,fetch(o.signedRequest,u);case 15:return d=e.sent,console.log("the return from s3",d),e.abrupt("return",o.url);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se=function(e){var t=e.type,r=e.name,a=e.form,c=e.disabled,i=e.fileType,o=void 0===i?"images":i,d=E(),b=Object(n.useState)(""),p=Object(s.a)(b,2),j=p[0],m=p[1],f=Object(n.useState)(!1),h=Object(s.a)(f,2),g=h[0],O=h[1],w=ye[o];return Object(v.jsxs)("div",{children:[Object(v.jsx)("input",{disabled:c,accept:w,type:t,name:r,onChange:function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O(!0),t&&t.target&&t.target.files){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,ke(t.target.files,d.appProxyPath);case 6:n=e.sent,a.setFieldValue(r,n),m(n),O(!1),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(3),console.error("error while uploading things",e.t0),alert("Sorry error while uploading, please try again later"),O(!1);case 17:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}()}),g&&Object(v.jsx)(x,{children:"Uploading..."}),j&&Object(v.jsx)("img",{src:j,width:"100",alt:"upload file"})]})},Ce=r(262),Pe=r(255),Fe=r.n(Pe);function Te(e){var t;return(null===e||void 0===e?void 0:e.title)?Object(v.jsxs)("div",{className:"mpr-product-search-option",style:{display:"flex",alignItems:"center"},children:[Object(v.jsx)("img",{width:32,src:null===e||void 0===e||null===(t=e.image)||void 0===t?void 0:t.src,alt:""}),Object(v.jsx)("span",{children:null===e||void 0===e?void 0:e.title})]}):e.label.replace("Create","Add")}function Re(e,t){console.log("Going to transform the stuff",e,t);var r=[],n=Object.keys(t).length;return e.resources&&e.resources.results&&e.resources.results.products&&e.resources.results.products.reduce((function(e,r){if(n&&!t[r.id])return console.log("Need to search collection, but the product not in collection"),e;var a=r.id,c=r.title,i=r.handle,s={src:r.image},o=null;return r.variants&&r.variants.length>0?r.variants.reduce((function(e,t){return o=t.id,"Default Title"!==t.title&&(c+=" ".concat(t.title)),t.featured_image&&(s.src=t.featured_image.url),e.push({id:a,title:c,handle:i,image:s,variantId:o}),e}),e):e.push({id:a,title:c,handle:i,image:s,variantId:o}),e}),r),console.log("Transformed",r),r}function Le(e,t){var r=e.toLocaleLowerCase().trim();return t.filter((function(e){return e.title.toLocaleLowerCase().indexOf(r)>-1||(!!(e.sku&&e.sku.toLocaleLowerCase().indexOf(r)>-1)||!!e.variants&&e.variants.filter((function(e){return!!e.sku&&e.sku.toLocaleLowerCase().indexOf(r)>-1})).length>0)}))}function qe(e,t,r){return Ae.apply(this,arguments)}function Ae(){return Ae=Object(u.a)(l.a.mark((function e(t,r,n){var a,c,i,s,o,u=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:4,e.prev=1,c="/search/suggest.json?q=".concat(t,"&resources[type]=product&resources[limit]=").concat(a,"&resources[options][unavailable_products]=last&resources[options][fields]=title,variants.title,variants.sku"),e.next=5,fetch(c);case 5:return i=e.sent,e.next=8,i.json();case 8:return s=e.sent,0===(o=Re(s,n)).length&&r&&r.length>0&&(console.log("going to search the collection product"),o=o.concat(Le(t,r))),e.abrupt("return",o);case 14:return e.prev=14,e.t0=e.catch(1),console.error("Error while doing shopify search",e.t0),e.abrupt("return",[]);case 18:case"end":return e.stop()}}),e,null,[[1,14]])}))),Ae.apply(this,arguments)}function De(e,t){return t.filter((function(t){return-1!==t.title.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())}))}var Ie=function(e){var t=e.placeholder,r=e.field,n=e.form,a=e.disabled,c=E(),i=B().getLng,s=c.collectionProducts||[];if(s&&s.length>0&&c.form.settings.productSearchDropdown){var o=i("productSearchSelectOption","Please select a product");return function(e){var t=e.placeholder,r=e.field,n=e.form,a=e.disabled,c=e.products,i=void 0===c?[]:c,s=e.noOptionsMessage;return Object(v.jsx)(ve.a,{cacheOptions:!0,formatOptionLabel:Te,isClearable:!0,isDisabled:a,defaultOptions:!0,name:r.name,value:r.value||"",placeholder:t||"",isOptionSelected:function(e,t){return t.some((function(t){return t.variantId===e.variantId}))},noOptionsMessage:function(){return s},onChange:function(e){if(e){var t=e;e&&(null===e||void 0===e?void 0:e.title)||(t={id:!1,title:e.label}),n.setFieldValue(r.name,t)}},loadOptions:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",De(t,i));case 2:return e.abrupt("return",i);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})}({placeholder:t,field:r,form:n,disabled:a,products:s,noOptionsMessage:o})}var d=null===s||void 0===s?void 0:s.reduce((function(e,t){return e[t.id]=t,e}),{}),b=function(){var e=Object(u.a)(l.a.mark((function e(t,r){var n,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=3;break}return r([]),e.abrupt("return",[]);case 3:return e.prev=3,e.next=7,qe(t,s,d);case 7:if(!((n=e.sent)&&n.length>0)){e.next=11;break}return r(n),e.abrupt("return",n);case 11:console.log("no search result from shopify search",n);case 12:return e.next=14,fetch("".concat(c.appProxyPath,"?q=").concat(t));case 14:return a=e.sent,e.next=17,a.json();case 17:return i=e.sent,r(i),e.abrupt("return",i);case 22:return e.prev=22,e.t0=e.catch(3),console.error("error while fetching",e.t0),r([]),e.abrupt("return",[]);case 27:case"end":return e.stop()}}),e,null,[[3,22]])})));return function(t,r){return e.apply(this,arguments)}}(),p=Fe()(b,300);return Object(v.jsx)(Ce.a,{cacheOptions:!0,formatOptionLabel:Te,isClearable:!0,isDisabled:a,defaultOptions:!0,name:r.name,value:r.value||"",placeholder:t||"",isOptionSelected:function(e,t){return t.some((function(t){return t.variantId===e.variantId}))},noOptionsMessage:function(){return i("productSearchPrompt","Keep type something to search product")},onChange:function(e){console.log("the opton",e);var t=e;e&&!e.title&&(t={id:!1,title:e?e.label:""}),n.setFieldValue(r.name,t)},loadOptions:p})},Ee=r(88),Me=r(43);function _e(e){return e.reduce((function(e,t){return Object(h.a)(Object(h.a)({},e),{},Object(Ee.a)({},t.name,t.value||t.default||""))}),{})}function He(e,t){var r=e.reduce((function(e,r){var n=t.requiredField.replace("[field]",r.label),a=t.invalidField.replace("[field]",r.label),c=Me.b((function(e){return r.type===Z.serialNumber&&r.required?Me.a().of(Me.e()).required(n).min(1,n).ensure():r.type===Z.product&&r.required?Me.d().required(n).nullable():r.type===Z.email&&r.required?Me.e().email(a).required(n):r.required?Me.e().required(n):Me.c()}));return Object(h.a)(Object(h.a)({},e),{},Object(Ee.a)({},r.name,c))}),{});return Me.d().shape(r)}var Be=r(259),Ve=r.n(Be),ze=(r(493),function(e){var t=e.children,r=e.isOpen;return Object(v.jsx)(Ve.a,{isOpen:r,ariaHideApp:!1,className:"mpr-modal",overlayClassName:"mpr-modal-overlay",appElement:document.getElementById("root"),children:t})}),Ue=(r(494),["options"]),Ge=["options"],Je=function(e){var t=e.fields,r=e.handleSubmit,n=e.children,a=B().languages,c=function(e){return Object(v.jsxs)(v.Fragment,{children:[e.description&&Object(v.jsx)("div",{children:e.description}),Object(v.jsx)("div",{className:"mpr-validation-error",children:Object(v.jsx)(re.a,{name:e.name})})]})};return Object(v.jsx)(re.d,{initialValues:_e(t),validationSchema:He(t,a),onSubmit:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.resetForm,e.prev=1,e.next=4,r(t);case 4:e.sent&&a(t);case 6:return e.prev=6,e.finish(6);case 8:case"end":return e.stop()}}),e,null,[[1,,6,8]])})));return function(t,r){return e.apply(this,arguments)}}(),children:function(e){return Object(v.jsxs)(re.c,{style:{marginBottom:30,marginTop:30},onSubmit:e.handleSubmit,children:[Object(v.jsx)(v.Fragment,{children:t.map((function(t){var r=[t.id,t.name,t.label].join("");switch(t.type){case Z.textInput:case Z.phone:case Z.email:return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsx)("div",{children:Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(ne,{label:t.label,required:t.required}),Object(v.jsx)(re.b,{name:t.name,disabled:e.isSubmitting,placeholder:t.placeholder})]})}),c(t)]},r);case Z.textArea:return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsx)("div",{children:Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(ne,{label:t.label,required:t.required}),Object(v.jsx)(re.b,{component:"textarea",rows:"4",name:t.name,disabled:e.isSubmitting,placeholder:t.placeholder})]})}),c(t)]},r);case Z.serialNumber:case Z.serialNumbers:return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsx)(re.b,Object(h.a)(Object(h.a)({},t),{},{children:function(r){return Object(v.jsx)(je,Object(h.a)(Object(h.a)(Object(h.a)({},r),t),{},{disabled:e.isSubmitting}))}})),c(t)]},r);case Z.file:return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(ne,{label:t.label,required:t.required}),Object(v.jsx)(re.b,Object(h.a)(Object(h.a)({},t),{},{disabled:e.isSubmitting,children:function(r){return Object(v.jsx)(Se,Object(h.a)(Object(h.a)(Object(h.a)({},r),t),{},{disabled:e.isSubmitting}))}}))]}),c(t)]},r);case Z.tickbox:return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsx)(se,Object(h.a)({disabled:e.isSubmitting},t)),c(t)]},r);case Z.radio:case Z.checkboxes:var n=t.options,a=Object(X.a)(t,Ue);return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{className:"mpr-input-label",children:Object(v.jsx)(ne,{label:t.label,required:t.required})}),Object(v.jsx)(ie,Object(h.a)(Object(h.a)({disabled:e.isSubmitting},a),{},{values:n}))]}),c(t)]},r);case Z.dropdown:var i=t.options,s=Object(X.a)(t,Ge);return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(ne,{label:t.label,required:t.required}),Object(v.jsx)(re.b,Object(h.a)(Object(h.a)({},t),{},{disabled:e.isSubmitting,children:function(t){return Object(v.jsx)(ce,Object(h.a)(Object(h.a)(Object(h.a)({},t),s),{},{values:i,disabled:e.isSubmitting}))}}))]}),c(t)]},r);case Z.date:var o=e.values[t.name];return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsx)("label",{className:"mpr-input-label",htmlFor:t.id,children:Object(v.jsx)(ne,{label:t.label,required:t.required})}),Object(v.jsx)(te.a,{id:t.id,disabled:e.isSubmitting,required:t.required,selected:o?new Date(o):null,dateFormat:"MMMM d, yyyy",onBlur:e.handleBlur,name:t.name,onChange:function(r){r&&e.setFieldValue(t.name,r.toString())}}),c(t)]},r);case Z.product:return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(ne,{label:t.label,required:t.required}),Object(v.jsx)(re.b,Object(h.a)(Object(h.a)({disabled:e.isSubmitting},t),{},{children:function(r){return Object(v.jsx)(Ie,Object(h.a)(Object(h.a)(Object(h.a)({},r),t),{},{disabled:e.isSubmitting}))}}))]}),c(t)]},r);case Z.country:return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(ne,{label:t.label,required:t.required}),Object(v.jsx)(re.b,Object(h.a)(Object(h.a)({},t),{},{disabled:e.isSubmitting,children:function(t){return Object(v.jsx)(we,Object(h.a)(Object(h.a)({},t),{},{disabled:e.isSubmitting}))}}))]}),c(t)]},r);case Z.state:var l,u,d=null!==(l=null===(u=e.values)||void 0===u?void 0:u.country)&&void 0!==l?l:"";return Object(v.jsxs)("div",{className:"form-group mpr-class-".concat(t.name),children:[Object(v.jsxs)("label",{className:"mpr-input-label",children:[Object(v.jsx)(ne,{label:t.label,required:t.required}),Object(v.jsx)(re.b,Object(h.a)(Object(h.a)({},t),{},{country:d,children:function(t){return Object(v.jsx)(ge,Object(h.a)(Object(h.a)({country:d},t),{},{disabled:!Boolean(d)||e.isSubmitting}))}}))]}),c(t)]},r);default:return Object(v.jsxs)("div",{className:"form-group mpr-class-not-implemented",children:["Not implemented field ",t.type]},r)}}))}),e.isSubmitting&&Object(v.jsx)(ze,{isOpen:e.isSubmitting,children:Object(v.jsx)(x,{})}),n(e)]})}})},Qe=function(e){var t,r=e.productFieldMapping,n=e.entries,a=e.formData;return Object(v.jsx)("div",{id:"mpr-product-list",children:Object(v.jsxs)("table",{width:"100%",children:[Object(v.jsx)("thead",{children:Object(v.jsx)("tr",{children:null===(t=a.find((function(e){return e.name===$.product})))||void 0===t?void 0:t.fields.map((function(e){return Object(v.jsx)("th",{role:"columnheader",colSpan:1,children:e.label},e.id)}))})}),Object(v.jsx)("tbody",{children:n.map((function(e,t){return Object(v.jsx)("tr",{role:"row",children:Object.keys(e).map((function(t,n){var a,c=e[t],i={};if(r&&(i=r[t]),"object"===typeof c)if("name"in c)a=c.name;else if(Array.isArray(c))a=c.join(", ");else{var s;a=Object(v.jsxs)("div",{style:{textAlign:"center"},children:[Object(v.jsx)("img",{width:80,src:null===c||void 0===c||null===(s=c.image)||void 0===s?void 0:s.src,alt:""}),Object(v.jsx)("div",{children:c.title})]})}else"file"===i.type?i.fileType&&"images"===i.fileType&&(a=Object(v.jsx)("img",{src:String(c),alt:"upload file",width:"80"})):a="date"===i.type?j(String(c)):c;return Object(v.jsx)("td",{role:"cell",children:a},n)}))},t)}))})]})})},Ke=function(e){var t,r,a,c=e.formData,i=e.onSubmit,o=e.skipCustomer,d=void 0!==o&&o,b=Object(n.useState)(),j=Object(s.a)(b,2),m=j[0],f=j[1],h=Object(n.useState)(!1),g=Object(s.a)(h,2),O=g[0],x=g[1],w=B().getLng,y=null===(t=c.find((function(e){return e.name===$.product})))||void 0===t?void 0:t.fields.reduce((function(e,t){return e[t.name]=t,e}),{});return Object(v.jsxs)(v.Fragment,{children:[m&&Array.isArray(m)&&Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(Qe,{productFieldMapping:y,formData:c,entries:m}),O&&Object(v.jsx)("button",{className:"btn btn-primary",onClick:function(){x(!1)},children:w("addAnotherProduct","Add another product")}),!O&&Object(v.jsx)("button",{className:"btn btn-primary",onClick:function(){x(!0)},children:w("cancelAddAnotherProduct","Cancel add another product")})]}),!O&&Object(v.jsx)(Je,{fields:null===(r=c.find((function(e){return e.name===$.product})))||void 0===r?void 0:r.fields,handleSubmit:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f((function(e){return e&&Array.isArray(e)?[].concat(Object(p.a)(e),[t]):[t]})),!d){e.next=3;break}return e.abrupt("return",i({},[t]));case 3:return x(!0),e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:function(e){return Object(v.jsx)("div",{className:"form-group",children:Object(v.jsx)("button",{className:"button btn btn-primary",disabled:e.isSubmitting,type:"submit",children:w("addProductButton","Add Product")})})}}),O&&m&&Array.isArray(m)&&Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("h2",{children:w("customerFormIntro","Almost there, a bit more about yourself")}),Object(v.jsx)(Je,{fields:null===(a=c.find((function(e){return e.name===$.customer})))||void 0===a?void 0:a.fields,handleSubmit:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i(t,m));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:function(e){return Object(v.jsx)("div",{className:"form-group",children:Object(v.jsx)("button",{className:"button btn btn-primary",disabled:e.isSubmitting,type:"submit",children:w("addFormButton","Register")})})}})]})]})},We=function(e){var t=e.formData,r=e.onSubmit,n=B().getLng;return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(Je,{fields:t.find((function(e){return e.name===$.all})).fields,handleSubmit:r,children:function(e){return Object(v.jsx)("div",{className:"form-group",children:Object(v.jsx)("button",{className:"button btn btn-primary",disabled:e.isSubmitting,type:"submit",children:n("addFormButton","Register")})})}})})},Ze=["productName","serialNumber","state","_extraTAndC"],$e=["image"],Ye=["state"],Xe=function(){var e=Object(u.a)(l.a.mark((function e(t){var r,n,a,c,i,s,o,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.productName,n=t.serialNumber,a=t.state,t._extraTAndC,c=Object(X.a)(t,Ze),console.log("the map product",{product:r,serialNumbers:n,restProps:c}),i=Object(h.a)({},c),a&&(i.state="object"===typeof a?a.label:a),i.product?(s=i.product,o=s.image,u=Object(X.a)(s,$e),i.product=Object(h.a)({imageUrl:null===o||void 0===o?void 0:o.src},u)):i.product={id:!1,title:""},i.serialNumbers||(i.serialNumber?i.serialNumbers=[].concat(i.serialNumber):i.serialNumbers=[]),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),et=function(e){var t=e.state,r=Object(X.a)(e,Ye);return Object(h.a)(Object(h.a)({},r),{},{state:"object"===typeof t?t.label:t})},tt=["name","firstName","surname","dob","email","address1","address2","city","country","state","postCode","phone","acceptMarketingOnAccountCreation"];function rt(e,t){var r=Object(h.a)({},e);if(r.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,r.locale=Intl.DateTimeFormat().resolvedOptions().locale,t){t.id&&(r.id=t.id,r.customerId=t.id);var n=Object(h.a)({},t);t.address&&(n.address1=t.address.address1,n.address2=t.address.address2,n.city=t.address.city,n.country=t.address.country_code,n.state=t.address.province,n.phone=t.address.phone,n.postCode=t.address.zip),tt.forEach((function(e){!r[e]&&n[e]&&(r[e]=n[e])}))}return r}function nt(e){return at.apply(this,arguments)}function at(){return(at=Object(u.a)(l.a.mark((function e(t){var r,n,a,c,i,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.loggedInCustomer,n=t.appProxyPath,a=t.slug,c=t.data,i=t.products,s={customer:{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,locale:Intl.DateTimeFormat().resolvedOptions().locale},sendEmails:!0,items:[]},i){e.next=11;break}return o=tt.reduce((function(e,t){return e[t]=c[t],delete c[t],e}),{}),s.customer=et(o),e.next=7,Xe(c);case 7:e.t0=e.sent,s.items=[e.t0],e.next=15;break;case 11:return s.customer=et(c),e.next=14,Promise.all(i.map(Xe));case 14:s.items=e.sent;case 15:return s.customer=rt(s.customer,r),e.abrupt("return",fetch(n,{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({payload:s,freeFormSlug:a})}).then((function(e){return e.json()})));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e,t,r,n){if(!e||0===e.length)return"";var a=null,c=e.map((function(t){return Object(v.jsx)("div",{className:"download-entry",children:Object(v.jsxs)("a",{href:t.url,onClick:function(){return console.log("Going to handle asset click"),void(n&&(a&&clearTimeout(a),console.log("going to redirect in download click"),a=setTimeout((function(){window.location.href=n}),3e3*e.length)))},target:"_blank",rel:"noreferrer",children:[Object(v.jsx)("span",{className:"mpr-asset-name",children:t.name})," ",Object(v.jsx)("span",{className:"mpr-download-action",children:r})]})})}));return Object(v.jsxs)("div",{className:"downloads-container",children:[Object(v.jsx)("h3",{className:"mpr-download-title",children:t}),c]})}var it=function(){var e=E(),t=e.form.fields,r=B().getLng,a=Object(n.useState)(!1),c=Object(s.a)(a,2),i=c[0],o=c[1],d=Object(n.useState)(null),b=Object(s.a)(d,2),p=b[0],j=b[1],m=Object(n.useState)([]),f=Object(s.a)(m,2),h=f[0],g=f[1],O=Object(n.useState)(null),x=Object(s.a)(O,2),w=x[0],y=x[1];Object(n.useEffect)((function(){if(p){if(console.log("going to redirect",h),h&&h.length>0)return void console.log("its the download page and do nothing");console.log("going ot redirect in the main one",h),setTimeout((function(){window.location.href=p}),3e3)}}),[p,h]),Object(n.useEffect)((function(){document.body.style.overflow=i?"hidden":"unset"}),[i]);var k=Object(n.useCallback)(function(){var t=Object(u.a)(l.a.mark((function t(r,n){var a,c,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,console.log("the data and the product",{data:r,products:n}),y(null),!e.form.settings.showDataCollectionConsent||e.productReg.customer){t.next=9;break}if(!0===r._extraTAndC){t.next=9;break}return a="Tick this for us to collect data in this form",e.languages&&e.languages.dataCollectionConsentQuestion&&(a=e.languages.dataCollectionConsentQuestion),alert("Required: ".concat(a)),t.abrupt("return");case 9:return"product-registration"!==(c="")&&(c=e.form.slug),t.next=13,nt({appProxyPath:e.appProxyPath,loggedInCustomer:e.productReg.customer,slug:c,data:r,products:n});case 13:if(!(i=t.sent).success){t.next=19;break}return o(!0),i.downloads&&g(i.downloads),i.redirect&&j(i.redirect),t.abrupt("return",!0);case 19:if(!i.error){t.next=22;break}return y(i.error),t.abrupt("return",!1);case 22:t.next=30;break;case 24:return t.prev=24,t.t0=t.catch(0),console.error("error submitting data >>",t.t0),alert("\ud83d\udc77Error wile submmitting data, please try it again\ud83d\udd04"),o(!1),t.abrupt("return",!1);case 30:case"end":return t.stop()}}),t,null,[[0,24]])})));return function(e,r){return t.apply(this,arguments)}}(),[e.appProxyPath,e.form.slug,e.form.settings.showDataCollectionConsent,e.languages,e.productReg.customer]),N=t?t.some((function(e){return e.name===$.all}))?Object(v.jsx)(We,{formData:t,onSubmit:k}):Object(v.jsx)(Ke,{formData:t,onSubmit:k,skipCustomer:e.form.settings.skipCustomer}):null,S=r("successRegistration"),C=r("successRegistrationBody"),P=ct(h,r("downloadsAvailable"),r("clickToDownload"),p);return Object(v.jsxs)("div",{id:"mpr-form",children:[e.form.description&&Object(v.jsx)("div",{className:"intro-wrapper",dangerouslySetInnerHTML:{__html:e.form.description}}),Object(v.jsx)("div",{id:"mpr-product-inputs",children:N}),w&&Object(v.jsx)("h3",{style:{color:"red"},children:w}),Object(v.jsx)(ze,{isOpen:i,children:Object(v.jsxs)("div",{className:"mpr-center mpr-success-container",children:[Object(v.jsx)("h1",{children:S}),C&&Object(v.jsx)("p",{children:C}),P,Object(v.jsx)("button",{className:"button btn btn-primary",onClick:function(){p?(console.log("Clicked ok and doing redirect"),window.location.href=p):window.location.reload()},children:"Ok"})]})})]})};var st=function(){var e,t=E();if(!(null===(e=t.productReg)||void 0===e?void 0:e.customCss))return null;var r='<style type="text/css">'.concat(t.productReg.customCss,"</style>");return Object(v.jsx)("div",{className:"customCSS",dangerouslySetInnerHTML:{__html:r}})},ot=function(){return Object(v.jsx)(P,{message:"\ud83d\udc77Something wrong with getting the form",children:Object(v.jsx)("div",{id:"product-registration",children:Object(v.jsx)("div",{id:"mpr-app-content",children:Object(v.jsx)(I,{children:Object(v.jsxs)(H,{children:[Object(v.jsx)(st,{}),Object(v.jsx)(P,{message:"\ud83d\udc77Something wrong with getting reigstered entries",children:Object(v.jsx)(Y,{})}),Object(v.jsx)(P,{message:"\ud83d\udc77Something wrong with render the form, please refresh\ud83d\udd04",children:Object(v.jsx)(it,{})})]})})})})})},lt=(r(537),function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,546)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;r(e),n(e),a(e),c(e),i(e)}))});i.a.render(Object(v.jsx)(a.a.StrictMode,{children:Object(v.jsx)(ot,{})}),document.getElementById("mpr-root")),lt()}},[[539,1,2]]]);